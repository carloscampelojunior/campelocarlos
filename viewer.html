<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Apresentação – Comparador estilo Juxtapose</title>
<style>
  :root{--line:#1f2937;--accent:#38bdf8;--bg:#0a1020;--text:#e5e7eb}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:500 15px/1.4 system-ui,Segoe UI,Roboto}
  .frame{position:fixed;inset:0;display:grid;place-items:center}
  .stage{position:relative;width:min(1200px,96vw);height:min(70vw,86vh);border:1px solid var(--line);border-radius:16px;overflow:hidden;background:#0b1120;touch-action:none}
  .layer{position:absolute;inset:0}
  .layer img{width:100%;height:100%;object-fit:contain;background:#0b1120}
  .mask{position:absolute;inset:0;overflow:hidden;pointer-events:none}
  .handle{position:absolute;top:0;bottom:0;width:2px;background:var(--accent);cursor:ew-resize;transform:translateX(-1px)}
  .knob{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:44px;height:44px;border-radius:999px;border:2px solid var(--accent);display:grid;place-items:center;background:#06111f;box-shadow:0 3px 14px #0008, inset 0 0 0 2px #06202e}
  .knob:after{content:"◄ ►";font-size:14px;color:var(--accent)}
  .legend{position:absolute;left:12px;right:12px;bottom:12px;display:flex;justify-content:space-between;gap:8px;pointer-events:none}
  .pill{padding:4px 8px;border-radius:999px;background:#0e1a30bb;border:1px solid #22314a;font-size:12px}
  .topbar{position:fixed;top:10px;left:50%;transform:translateX(-50%);background:#0e1a30bb;border:1px solid #22314a;border-radius:10px;padding:6px 10px;font-size:13px;color:#cfefff}
  .toast{position:fixed;left:50%;bottom:14px;transform:translateX(-50%);background:#0e1a30; border:1px solid #22314a;border-radius:10px;padding:8px 12px;max-width:min(92vw,900px)}
  .toast code{color:#bfe6ff}
  .btn{background:#0e1a30;border:1px solid #22314a;color:#e2e8f0;padding:6px 10px;border-radius:10px;cursor:pointer}
  .btn:hover{border-color:#2e476f}
</style>
</head>
<body>
<div class="topbar" id="title">Comparador</div>

<div class="frame">
  <div class="stage" id="stage" tabindex="0" aria-label="Comparador (arraste a barra)">
    <div class="layer"><img id="imgRight" alt=""></div>
    <div class="mask" id="mask"><img id="imgLeft" alt=""></div>
    <div class="handle" id="handle" style="left:50%"><div class="knob"></div></div>
    <div class="legend"><span class="pill" id="leftLabel">Esquerda</span><span class="pill" id="rightLabel">Direita</span></div>
  </div>
</div>

<div id="toast" class="toast" style="display:none"></div>

<script>
(function(){
  const q = new URLSearchParams(location.search);

  // Util: normaliza link do Dropbox
  const normalizeDropbox = (url) => {
    if (!url) return '';
    try {
      const u = new URL(url);
      // troca dl=0 por raw=1
      if (u.searchParams.has('dl')) {
        u.searchParams.delete('dl');
        u.searchParams.set('raw','1');
      } else if (!u.searchParams.has('raw')) {
        // se não tem dl nem raw, força raw=1
        u.searchParams.set('raw','1');
      }
      return u.toString();
    } catch(e) {
      return url; // se não for URL válida, retorna como veio
    }
  };

  let left  = q.get('left')  || '';
  let right = q.get('right') || '';
  const lLab  = q.get('l') || 'Esquerda';
  const rLab  = q.get('r') || 'Direita';
  const posQS = Math.max(0, Math.min(100, Number(q.get('pos')||50))) / 100;

  // Normaliza possíveis links do Dropbox
  left  = normalizeDropbox(left);
  right = normalizeDropbox(right);

  const imgL = document.getElementById('imgLeft');
  const imgR = document.getElementById('imgRight');
  const mask = document.getElementById('mask');
  const handle = document.getElementById('handle');
  const stage = document.getElementById('stage');
  const toast = document.getElementById('toast');

  const showToast = (html) => { toast.innerHTML = html; toast.style.display = 'block'; };
  const hideToast = () => { toast.style.display = 'none'; };

  // Mensagem se faltar parâmetro
  if (!left || !right) {
    showToast(
      'Parâmetros ausentes. Use: <code>?left=URL&right=URL&l=Antes&r=Depois&pos=50</code><br>' +
      'Exemplo (Dropbox): <code>?left=https%3A%2F%2Fwww.dropbox.com%2Fs%2Fa1b2%2Fantes.jpg%3Fraw%3D1&right=https%3A%2F%2Fwww.dropbox.com%2Fs%2Fc3d4%2Fdepois.jpg%3Fraw%3D1</code><br><br>' +
      '<button class="btn" id="demoBtn">Carregar demo</button>'
    );
    document.getElementById('demoBtn').onclick = () => {
      // imagens demo públicas (data URIs simples de gradiente)
      const demoL = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="900"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#a7f3d0"/><stop offset="1" stop-color="#34d399"/></linearGradient></defs><rect width="100%" height="100%" fill="url(#g)"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="80" fill="#064e3b">ANTES</text></svg>');
      const demoR = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="900"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#93c5fd"/><stop offset="1" stop-color="#3b82f6"/></linearGradient></defs><rect width="100%" height="100%" fill="url(#g)"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="80" fill="#1e3a8a">DEPOIS</text></svg>');
      const url = new URL(location.href);
      url.search = '';
      url.searchParams.set('left', demoL);
      url.searchParams.set('right', demoR);
      url.searchParams.set('l', 'Antes');
      url.searchParams.set('r', 'Depois');
      url.searchParams.set('pos', '50');
      location.href = url.toString();
    };
  }

  document.getElementById('leftLabel').textContent  = lLab;
  document.getElementById('rightLabel').textContent = rLab;
  document.getElementById('title').textContent = `${lLab} × ${rLab}`;

  // Carrega imagens com tratamento de erro
  let errors = [];
  imgL.onerror = () => { errors.push('Erro ao carregar imagem ESQUERDA. Verifique a URL (use ?raw=1 no Dropbox).'); showToast(errors.join('<br>')); };
  imgR.onerror = () => { errors.push('Erro ao carregar imagem DIREITA. Verifique a URL (use ?raw=1 no Dropbox).'); showToast(errors.join('<br>')); };
  imgL.onload = imgR.onload = () => { if (imgL.complete && imgR.complete && errors.length===0) hideToast(); };

  imgL.src = left;
  imgR.src = right;

  let pos = posQS || 0.5;
  function setPos(p, anim=false){
    pos = Math.max(0.02, Math.min(0.98, p));
    const w = stage.clientWidth, x = Math.round(w*pos);
    mask.style.clipPath = `inset(0 ${Math.max(0,w-x)}px 0 0)`;
    handle.style.left = x+'px';
    if(anim){
      handle.style.transition='left .18s ease';
      mask.style.transition='clip-path .18s ease';
      setTimeout(()=>{handle.style.transition='';mask.style.transition='';},200);
    }
  }
  setPos(pos,true);
  new ResizeObserver(()=> setPos(pos)).observe(stage);

  // Interação
  let dragging=false;
  function fromX(cx){const r=stage.getBoundingClientRect(); setPos((cx-r.left)/r.width);}
  handle.addEventListener('mousedown',()=>{dragging=true; document.body.style.userSelect='none';});
  window.addEventListener('mouseup',()=>{dragging=false; document.body.style.userSelect='';});
  window.addEventListener('mousemove',e=>{if(dragging)fromX(e.clientX)});
  handle.addEventListener('touchstart',e=>{dragging=true; fromX(e.touches[0].clientX)},{passive:true});
  window.addEventListener('touchmove',e=>{if(dragging)fromX(e.touches[0].clientX)},{passive:true});
  window.addEventListener('touchend',()=>{dragging=false; document.body.style.userSelect='';});
  stage.addEventListener('dblclick',()=> setPos(0.5,true));
  stage.addEventListener('keydown',e=>{
    const step=e.shiftKey?0.05:0.01;
    if(e.key==='ArrowLeft') setPos(pos-step,true);
    if(e.key==='ArrowRight') setPos(pos+step,true);
  });
})();
</script>
</body>
</html>